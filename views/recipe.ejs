<%- include('partials/header') %>

<div class="container mt-4">
  <div class="card mb-4">
    <img src="<%= recipe.photo %>" class="card-img-top" alt="Recipe Image">
    <div class="card-body">
      <!-- 菜谱描述 -->
      <h3 class="card-title"><%= recipe.description %></h3>

      <!-- 配料 -->
      <h5>Ingredients</h5>
      <ul>
        <% recipe.ingredient.forEach(item => { %>
          <li><%= item %></li>
        <% }) %>
      </ul>

      <!-- 做法 -->
      <h5>Instructions</h5>
      <p><%= recipe.instruction %></p>

      <!-- 点赞数显示 -->
      <p>Likes: <span id="like-count"><%= recipe.likes || 0 %></span></p>

      <!-- 点赞按钮 -->
      <button id="like-btn" class="btn btn-primary">Like</button>
    </div>
  </div>

  <!-- 作者信息 -->
  <% if (creator) { %>
    <div class="mb-4">
      <h5>Recipe Created By:</h5>
      <p><%= creator.first_name %> <%= creator.last_name %></p>
    </div>
  <% } %>

  <!-- 评论部分 -->
  <div class="comments-section">
    <h4>Comments</h4>
    <p>Comment functionality can be added here.</p>
  </div>
</div>

<%- include('partials/footer') %>

<!-- 点赞按钮脚本 -->
<script>
  document.getElementById('like-btn').addEventListener('click', async () => {
    try {
      // 发送点赞请求
      const response = await fetch('/recipes/like/<%= recipe._id %>', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });

      const data = await response.json();

      if (data.success) {
        // 更新点赞数
        document.getElementById('like-count').innerText = data.likes;
        document.getElementById('like-btn').innerText = 'Liked';
        document.getElementById('like-btn').disabled = true;
      } else {
        alert(data.message || 'Unable to like this recipe.');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('An error occurred while liking the recipe.');
    }
  });
</script>
