<%- include('partials/header') %>

<div class="container mt-4">
  <div class="card mb-4">
    <% if (recipe.photo) { %>
      <!-- Replace 'image/jpeg' with the actual MIME type if different -->
      <img src="data:image/jpeg;base64,<%= recipe.photo %>" class="card-img-top" alt="Recipe Image">
    <% } else { %>
      <!-- Fallback image if no photo is available -->
      <img src="https://cdn.glitch.global/40caaa32-7609-49ce-895e-9832535559ab/FOOD.jpg?v=1734423437576" class="card-img-top" alt="Default Recipe Image">
    <% } %>
    <div class="card-body">
      <!-- Recipe Description -->
      <h3 class="card-title"><%= recipe.description %></h3>

      <!-- Ingredients -->
      <h5>Ingredients</h5>
      <ul>
        <% recipe.ingredient.forEach(item => { %>
          <li><%= item %></li>
        <% }) %>
      </ul>

      <!-- Instructions -->
      <h5>Instructions</h5>
      <p><%= recipe.instruction %></p>

      <!-- Likes Display -->
      <p>Likes: <span id="like-count"><%= recipe.likes || 0 %></span></p>

      <!-- Like Button -->
      <button id="like-btn" class="btn btn-primary">Like</button>
    </div>
  </div>

  <!-- Author Information -->
  <% if (creator) { %>
    <div class="mb-4">
      <h5>Recipe Created By:</h5>
      <p><%= creator.first_name %> <%= creator.last_name %></p>
    </div>
  <% } %>

  <!-- Comments Section -->
  <div class="comments-section">
    <h4>Comments</h4>
    <p>Comment functionality can be added here.</p>
  </div>
</div>

<%- include('partials/footer') %>

<!-- Like Button Script -->
<script>
  document.getElementById('like-btn').addEventListener('click', async () => {
    try {
      // Send like request
      const response = await fetch('/recipes/like/<%= recipe._id %>', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });

      const data = await response.json();

      if (data.success) {
        // Update like count
        document.getElementById('like-count').innerText = data.likes;
        document.getElementById('like-btn').innerText = 'Liked';
        document.getElementById('like-btn').disabled = true;
      } else {
        alert(data.message || 'Unable to like this recipe.');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('An error occurred while liking the recipe.');
    }
  });
</script>
